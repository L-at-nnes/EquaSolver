<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>EquaSolver Manual Test Suite</title>
    <style>
        body {
            font-family: 'Courier New', monospace;
            background: #0a0a0f;
            color: #00ff41;
            padding: 2rem;
            max-width: 1200px;
            margin: 0 auto;
        }
        h1 {
            color: #00ffff;
            border-bottom: 2px solid #00ff41;
            padding-bottom: 0.5rem;
        }
        h2 {
            color: #ff00ff;
            margin-top: 2rem;
            border-bottom: 1px solid #555;
            padding-bottom: 0.3rem;
        }
        .test-suite {
            margin: 0.5rem 0;
            border: 1px solid #333;
            padding: 0.5rem 1rem;
            border-radius: 4px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .test-suite.pass {
            border-color: #00ff41;
            background: rgba(0, 255, 65, 0.05);
        }
        .test-suite.fail {
            border-color: #ff0080;
            background: rgba(255, 0, 128, 0.1);
        }
        .test-name {
            font-weight: bold;
        }
        .test-result {
            font-size: 0.9rem;
        }
        .test-result.pass {
            color: #00ff41;
        }
        .test-result.fail {
            color: #ff0080;
        }
        .summary {
            margin-top: 2rem;
            padding: 1.5rem;
            background: rgba(0, 255, 255, 0.1);
            border-radius: 8px;
            font-size: 1.3rem;
            text-align: center;
            border: 2px solid #00ffff;
        }
        .pass-count {
            color: #00ff41;
            font-weight: bold;
        }
        .fail-count {
            color: #ff0080;
            font-weight: bold;
        }
        .section {
            margin-bottom: 1rem;
        }
        .error-details {
            font-size: 0.8rem;
            color: #ff6699;
            margin-top: 0.3rem;
        }
    </style>
</head>
<body>
    <h1>üß™ EquaSolver Manual Test Suite</h1>
    <div class="summary" id="summary">Running tests...</div>
    <div id="test-output"></div>

    <!-- Load all modules -->
    <script src="../../src/js/flags.js"></script>
    <script src="../../src/js/i18n/en.js"></script>
    <script src="../../src/js/i18n/fr.js"></script>
    <script src="../../src/js/i18n/es.js"></script>
    <script src="../../src/js/i18n/de.js"></script>
    <script src="../../src/js/i18n/it.js"></script>
    <script src="../../src/js/i18n/ru.js"></script>
    <script src="../../src/js/translations.js"></script>
    
    <!-- Math modules -->
    <script src="../../src/js/math/complex.js"></script>
    <script src="../../src/js/math/matrix.js"></script>
    <script src="../../src/js/math/gcd-lcm.js"></script>
    <script src="../../src/js/math/modular.js"></script>
    <script src="../../src/js/math/combinatorics.js"></script>
    <script src="../../src/js/math/fractions.js"></script>
    <script src="../../src/js/math/statistics.js"></script>
    <script src="../../src/js/math/sequences.js"></script>
    
    <!-- Calculus modules -->
    <script src="../../src/js/calculus/limits.js"></script>
    <script src="../../src/js/calculus/taylor.js"></script>
    <script src="../../src/js/calculus/numerical-integration.js"></script>
    
    <!-- Solver modules -->
    <script src="../../src/js/solvers/inequality.js"></script>
    <script src="../../src/js/solvers/polynomial-division.js"></script>
    
    <!-- Converter modules -->
    <script src="../../src/js/converters/base.js"></script>
    <script src="../../src/js/converters/units.js"></script>
    
    <!-- Parser modules -->
    <script src="../../src/js/parsers/expression.js"></script>
    <script src="../../src/js/parsers/latex.js"></script>
    
    <!-- UI modules -->
    <script src="../../src/js/ui/animations.js"></script>
    <script src="../../src/js/ui/themes.js"></script>
    <script src="../../src/js/ui/history.js"></script>
    <script src="../../src/js/ui/export.js"></script>
    <script src="../../src/js/ui/calculator.js"></script>
    
    <!-- Graphing modules -->
    <script src="../../src/js/graphing/cartesian.js"></script>
    <script src="../../src/js/graphing/parametric.js"></script>
    <script src="../../src/js/graphing/polar.js"></script>
    
    <!-- Main script (must be last) -->
    <script src="../../src/js/script.js"></script>
    <script>
        // Enhanced Test Runner
        class TestRunner {
            constructor() {
                this.tests = [];
                this.passed = 0;
                this.failed = 0;
                this.currentSection = 'General';
            }

            section(name) {
                this.currentSection = name;
            }

            test(name, fn) {
                this.tests.push({ name, fn, section: this.currentSection });
            }

            async run() {
                const output = document.getElementById('test-output');
                let currentSection = '';
                
                for (const test of this.tests) {
                    // Add section header if new section
                    if (test.section !== currentSection) {
                        currentSection = test.section;
                        const header = document.createElement('h2');
                        header.textContent = currentSection;
                        output.appendChild(header);
                    }

                    const div = document.createElement('div');
                    div.className = 'test-suite';
                    
                    const nameDiv = document.createElement('div');
                    nameDiv.className = 'test-name';
                    nameDiv.textContent = test.name;
                    div.appendChild(nameDiv);

                    const resultDiv = document.createElement('div');
                    resultDiv.className = 'test-result';

                    try {
                        await test.fn();
                        div.classList.add('pass');
                        resultDiv.classList.add('pass');
                        resultDiv.textContent = '‚úì PASS';
                        this.passed++;
                    } catch (error) {
                        div.classList.add('fail');
                        resultDiv.classList.add('fail');
                        resultDiv.textContent = '‚úó FAIL';
                        this.failed++;
                        
                        const errorDiv = document.createElement('div');
                        errorDiv.className = 'error-details';
                        errorDiv.textContent = error.message;
                        div.appendChild(errorDiv);
                    }

                    div.appendChild(resultDiv);
                    output.appendChild(div);
                }

                this.showSummary();
            }

            showSummary() {
                const summary = document.getElementById('summary');
                const total = this.passed + this.failed;
                const percent = ((this.passed / total) * 100).toFixed(1);
                summary.innerHTML = `
                    <strong>üìä Test Results</strong><br><br>
                    Total: <strong>${total}</strong> | 
                    <span class="pass-count">‚úì ${this.passed} passed</span> | 
                    <span class="fail-count">‚úó ${this.failed} failed</span><br>
                    <strong>Coverage: ${percent}%</strong>
                `;
            }

            assertEquals(actual, expected, message = '') {
                if (typeof expected === 'number' && typeof actual === 'number') {
                    if (Math.abs(actual - expected) > 0.0001) {
                        throw new Error(`${message} Expected ${expected}, got ${actual}`);
                    }
                } else if (actual !== expected) {
                    throw new Error(`${message} Expected ${expected}, got ${actual}`);
                }
            }

            assertArrayEquals(actual, expected, tolerance = 0.001, message = '') {
                if (actual.length !== expected.length) {
                    throw new Error(`${message} Array length mismatch: expected ${expected.length}, got ${actual.length}`);
                }
                for (let i = 0; i < expected.length; i++) {
                    if (Math.abs(actual[i] - expected[i]) > tolerance) {
                        throw new Error(`${message} At index ${i}: expected ${expected[i]}, got ${actual[i]}`);
                    }
                }
            }

            assertTrue(condition, message = '') {
                if (!condition) {
                    throw new Error(`${message || 'Assertion failed'} - Expected true, got false`);
                }
            }

            assertFalse(condition, message = '') {
                if (condition) {
                    throw new Error(`${message || 'Assertion failed'} - Expected false, got true`);
                }
            }

            assertContains(str, substring, message = '') {
                if (!str.includes(substring)) {
                    throw new Error(`${message} Expected "${str}" to contain "${substring}"`);
                }
            }

            assertClose(actual, expected, tolerance = 0.01, message = '') {
                if (Math.abs(actual - expected) > tolerance) {
                    throw new Error(`${message} Expected ${expected} (¬±${tolerance}), got ${actual}`);
                }
            }
        }

        // Initialize test runner
        const runner = new TestRunner();

        // ===================================
        // LINEAR EQUATION TESTS
        // ===================================
        runner.section('üìê Linear Equations');
        
        runner.test('x + 2 = 0 ‚Üí x = -2', () => {
            const x = -2 / 1;
            runner.assertEquals(x, -2);
        });

        runner.test('2x - 4 = 0 ‚Üí x = 2', () => {
            const x = 4 / 2;
            runner.assertEquals(x, 2);
        });

        runner.test('-3x + 9 = 0 ‚Üí x = 3', () => {
            const x = -9 / -3;
            runner.assertEquals(x, 3);
        });

        runner.test('5x + 15 = 0 ‚Üí x = -3', () => {
            const x = -15 / 5;
            runner.assertEquals(x, -3);
        });

        runner.test('0.5x - 1 = 0 ‚Üí x = 2', () => {
            const x = 1 / 0.5;
            runner.assertEquals(x, 2);
        });

        // ===================================
        // QUADRATIC EQUATION TESTS
        // ===================================
        runner.section('üìà Quadratic Equations');
        
        runner.test('x¬≤ - 5x + 6 = 0 ‚Üí x = 2, 3', () => {
            const a = 1, b = -5, c = 6;
            const delta = b * b - 4 * a * c;
            runner.assertEquals(delta, 1, 'Discriminant');
            const x1 = (-b + Math.sqrt(delta)) / (2 * a);
            const x2 = (-b - Math.sqrt(delta)) / (2 * a);
            runner.assertEquals(x1, 3);
            runner.assertEquals(x2, 2);
        });

        runner.test('x¬≤ - 4 = 0 ‚Üí x = ¬±2', () => {
            const a = 1, b = 0, c = -4;
            const delta = b * b - 4 * a * c;
            runner.assertEquals(delta, 16, 'Discriminant');
        });

        runner.test('x¬≤ + 2x + 1 = 0 ‚Üí x = -1 (double)', () => {
            const a = 1, b = 2, c = 1;
            const delta = b * b - 4 * a * c;
            runner.assertEquals(delta, 0, 'Discriminant = 0');
        });

        runner.test('x¬≤ + 1 = 0 ‚Üí complex roots (Œî < 0)', () => {
            const a = 1, b = 0, c = 1;
            const delta = b * b - 4 * a * c;
            runner.assertTrue(delta < 0, 'Should have negative discriminant');
        });

        runner.test('2x¬≤ - 8x + 6 = 0 ‚Üí x = 1, 3', () => {
            const a = 2, b = -8, c = 6;
            const delta = b * b - 4 * a * c;
            const x1 = (-b + Math.sqrt(delta)) / (2 * a);
            const x2 = (-b - Math.sqrt(delta)) / (2 * a);
            runner.assertEquals(x1, 3);
            runner.assertEquals(x2, 1);
        });

        // ===================================
        // CUBIC EQUATION TESTS
        // ===================================
        runner.section('üìä Cubic Equations');
        
        runner.test('x¬≥ - 6x¬≤ + 11x - 6 = 0 has 3 real roots', () => {
            const a = 1, b = -6, c = 11, d = -6;
            const p = (3 * a * c - b * b) / (3 * a * a);
            const q = (2 * b * b * b - 9 * a * b * c + 27 * a * a * d) / (27 * a * a * a);
            const discriminant = -(4 * p * p * p + 27 * q * q);
            runner.assertTrue(discriminant > 0, 'Discriminant > 0 means 3 real roots');
        });

        runner.test('x¬≥ - 1 = 0 has real root x = 1', () => {
            const result = Math.cbrt(1);
            runner.assertEquals(result, 1);
        });

        // ===================================
        // POLYNOMIAL ROOTS (DURAND-KERNER)
        // ===================================
        runner.section('üî¢ Numerical Methods (Durand-Kerner)');
        
        runner.test('Quartic x‚Å¥ - 5x¬≤ + 4 = 0 ‚Üí ¬±1, ¬±2', () => {
            const roots = findPolynomialRoots([1, 0, -5, 0, 4]);
            runner.assertEquals(roots.length, 4);
            runner.assertArrayEquals(roots, [-2, -1, 1, 2], 0.01);
        });

        runner.test('Quartic (x-1)(x-2)(x-3)(x-4) = 0', () => {
            const roots = findPolynomialRoots([1, -10, 35, -50, 24]);
            runner.assertEquals(roots.length, 4);
            runner.assertArrayEquals(roots, [1, 2, 3, 4], 0.01);
        });

        runner.test('Quintic (x-1)(x-2)(x-3)(x+1)(x+2) = 0', () => {
            const roots = findPolynomialRoots([1, -3, -5, 15, 4, -12]);
            runner.assertEquals(roots.length, 5);
            runner.assertArrayEquals(roots, [-2, -1, 1, 2, 3], 0.01);
        });

        runner.test('Quintic with numerical stability', () => {
            const roots = findPolynomialRoots([1, 0, -15, 10, 60, -72]);
            runner.assertTrue(roots.length > 0);
        });

        runner.test('Quadratic via findPolynomialRoots: x¬≤ - 4 = 0', () => {
            const roots = findPolynomialRoots([1, 0, -4]);
            runner.assertEquals(roots.length, 2);
        });

        // ===================================
        // COMPLEX NUMBER OPERATIONS
        // ===================================
        runner.section('üîÆ Complex Numbers');
        
        runner.test('Addition: (3+4i) + (1+2i) = 4+6i', () => {
            const result = complexAdd({ re: 3, im: 4 }, { re: 1, im: 2 });
            runner.assertEquals(result.re, 4);
            runner.assertEquals(result.im, 6);
        });

        runner.test('Subtraction: (5+7i) - (2+3i) = 3+4i', () => {
            const result = complexSub({ re: 5, im: 7 }, { re: 2, im: 3 });
            runner.assertEquals(result.re, 3);
            runner.assertEquals(result.im, 4);
        });

        runner.test('Multiplication: (2+3i)(4+5i) = -7+22i', () => {
            const result = complexMul({ re: 2, im: 3 }, { re: 4, im: 5 });
            runner.assertEquals(result.re, -7);
            runner.assertEquals(result.im, 22);
        });

        runner.test('Division: (10+5i)/(2+i) = 5+0i', () => {
            const result = complexDiv({ re: 10, im: 5 }, { re: 2, im: 1 });
            runner.assertEquals(result.re, 5);
            runner.assertEquals(result.im, 0);
        });

        runner.test('Power: (2+0i)¬≥ = 8+0i', () => {
            const result = complexPow({ re: 2, im: 0 }, 3);
            runner.assertEquals(result.re, 8);
            runner.assertEquals(result.im, 0);
        });

        runner.test('Scale: 3*(2+4i) = 6+12i', () => {
            const result = complexScale({ re: 2, im: 4 }, 3);
            runner.assertEquals(result.re, 6);
            runner.assertEquals(result.im, 12);
        });

        runner.test('Absolute value: |3+4i| = 5', () => {
            const result = complexAbs({ re: 3, im: 4 });
            runner.assertEquals(result, 5);
        });

        runner.test('Conjugate: conj(3+4i) = 3-4i', () => {
            const result = complexConjugate({ re: 3, im: 4 });
            runner.assertEquals(result.re, 3);
            runner.assertEquals(result.im, -4);
        });

        runner.test('From real: 5 ‚Üí 5+0i', () => {
            const result = complexFromReal(5);
            runner.assertEquals(result.re, 5);
            runner.assertEquals(result.im, 0);
        });

        runner.test('Format: 3+4i displays correctly', () => {
            const result = formatComplex({ re: 3, im: 4 });
            runner.assertContains(result, '3');
            runner.assertContains(result, '4');
        });

        runner.test('isEssentiallyReal: (5, 1e-11) is real', () => {
            runner.assertTrue(isEssentiallyReal({ re: 5, im: 1e-11 }));
        });

        runner.test('isEssentiallyZero: (1e-11, 1e-11) is zero', () => {
            runner.assertTrue(isEssentiallyZero({ re: 1e-11, im: 1e-11 }));
        });

        runner.test('Polynomial evaluation: x¬≤-3x+2 at x=1 = 0', () => {
            const result = evalPoly([1, -3, 2], { re: 1, im: 0 });
            runner.assertEquals(result.re, 0, 'Should be 0 at root');
        });

        runner.test('Polynomial evaluation: x¬≤-3x+2 at x=2 = 0', () => {
            const result = evalPoly([1, -3, 2], { re: 2, im: 0 });
            runner.assertEquals(result.re, 0, 'Should be 0 at root');
        });

        // ===================================
        // INEQUALITY SOLVER TESTS
        // ===================================
        runner.section('‚öñÔ∏è Linear Inequalities');
        
        runner.test('2x - 4 < 0 ‚Üí x < 2', () => {
            const result = solveLinearInequality(2, -4, '<');
            runner.assertEquals(result.type, 'interval');
            runner.assertContains(result.solution, 'x < 2');
        });

        runner.test('2x - 4 > 0 ‚Üí x > 2', () => {
            const result = solveLinearInequality(2, -4, '>');
            runner.assertEquals(result.type, 'interval');
            runner.assertContains(result.solution, 'x > 2');
        });

        runner.test('3x + 6 <= 0 ‚Üí x ‚â§ -2', () => {
            const result = solveLinearInequality(3, 6, '<=');
            runner.assertEquals(result.type, 'interval');
            runner.assertContains(result.solution, 'x ‚â§ -2');
        });

        runner.test('3x + 6 >= 0 ‚Üí x ‚â• -2', () => {
            const result = solveLinearInequality(3, 6, '>=');
            runner.assertEquals(result.type, 'interval');
            runner.assertContains(result.solution, 'x ‚â• -2');
        });

        runner.test('-2x + 4 < 0 ‚Üí x > 2 (flip)', () => {
            const result = solveLinearInequality(-2, 4, '<');
            runner.assertContains(result.solution, 'x > 2');
        });

        runner.test('-2x + 4 > 0 ‚Üí x < 2 (flip)', () => {
            const result = solveLinearInequality(-2, 4, '>');
            runner.assertContains(result.solution, 'x < 2');
        });

        runner.test('0x - 3 < 0 ‚Üí ‚Ñù (always true)', () => {
            const result = solveLinearInequality(0, -3, '<');
            runner.assertEquals(result.type, 'all');
        });

        runner.test('0x + 3 < 0 ‚Üí ‚àÖ (never true)', () => {
            const result = solveLinearInequality(0, 3, '<');
            runner.assertEquals(result.type, 'none');
        });

        runner.section('üìâ Quadratic Inequalities');

        runner.test('x¬≤ - 5x + 6 > 0 ‚Üí x < 2 or x > 3', () => {
            const result = solveQuadraticInequality(1, -5, 6, '>');
            runner.assertEquals(result.type, 'union');
        });

        runner.test('x¬≤ - 5x + 6 < 0 ‚Üí 2 < x < 3', () => {
            const result = solveQuadraticInequality(1, -5, 6, '<');
            runner.assertEquals(result.type, 'interval');
        });

        runner.test('x¬≤ - 4x + 4 > 0 ‚Üí x ‚â† 2 (Œî=0)', () => {
            const result = solveQuadraticInequality(1, -4, 4, '>');
            runner.assertContains(result.solution, '‚â†');
        });

        runner.test('x¬≤ - 4x + 4 >= 0 ‚Üí ‚Ñù (Œî=0)', () => {
            const result = solveQuadraticInequality(1, -4, 4, '>=');
            runner.assertEquals(result.type, 'all');
        });

        runner.test('x¬≤ - 4x + 4 < 0 ‚Üí ‚àÖ (Œî=0)', () => {
            const result = solveQuadraticInequality(1, -4, 4, '<');
            runner.assertEquals(result.type, 'none');
        });

        runner.test('x¬≤ + 1 > 0 ‚Üí ‚Ñù (Œî<0, always positive)', () => {
            const result = solveQuadraticInequality(1, 0, 1, '>');
            runner.assertEquals(result.type, 'all');
        });

        runner.test('x¬≤ + 1 < 0 ‚Üí ‚àÖ (Œî<0, never negative)', () => {
            const result = solveQuadraticInequality(1, 0, 1, '<');
            runner.assertEquals(result.type, 'none');
        });

        runner.test('-x¬≤ - 1 < 0 ‚Üí ‚Ñù (always negative)', () => {
            const result = solveQuadraticInequality(-1, 0, -1, '<');
            runner.assertEquals(result.type, 'all');
        });

        runner.test('-x¬≤ + 5x - 6 > 0 ‚Üí 2 < x < 3 (opens down)', () => {
            const result = solveQuadraticInequality(-1, 5, -6, '>');
            runner.assertEquals(result.type, 'interval');
        });

        runner.test('0x¬≤ + 2x - 4 > 0 ‚Üí x > 2 (degenerates to linear)', () => {
            const result = solveQuadraticInequality(0, 2, -4, '>');
            runner.assertEquals(result.type, 'interval');
        });

        runner.section('üîß Inequality Helpers');

        runner.test('flipOperator: < ‚Üí >', () => {
            runner.assertEquals(flipOperator('<'), '>');
        });

        runner.test('flipOperator: > ‚Üí <', () => {
            runner.assertEquals(flipOperator('>'), '<');
        });

        runner.test('flipOperator: <= ‚Üí >=', () => {
            runner.assertEquals(flipOperator('<='), '>=');
        });

        runner.test('flipOperator: >= ‚Üí <=', () => {
            runner.assertEquals(flipOperator('>='), '<=');
        });

        runner.test('evaluateComparison: 3 < 5', () => {
            runner.assertTrue(evaluateComparison(3, 5, '<'));
        });

        runner.test('evaluateComparison: 5 > 3', () => {
            runner.assertTrue(evaluateComparison(5, 3, '>'));
        });

        runner.test('evaluateComparison: 3 <= 3', () => {
            runner.assertTrue(evaluateComparison(3, 3, '<='));
        });

        runner.test('evaluateComparison: 3 >= 3', () => {
            runner.assertTrue(evaluateComparison(3, 3, '>='));
        });

        runner.test('formatOperator: <= ‚Üí ‚â§', () => {
            runner.assertEquals(formatOperator('<='), '‚â§');
        });

        runner.test('formatOperator: >= ‚Üí ‚â•', () => {
            runner.assertEquals(formatOperator('>='), '‚â•');
        });

        // ===================================
        // SYSTEM OF EQUATIONS TESTS
        // ===================================
        runner.section('üìù Systems of Equations');
        
        runner.test('2x + y = 5, x - y = 1 ‚Üí x=2, y=1', () => {
            const a = 2, b = 1, e = 5;
            const c = 1, d = -1, f = 1;
            const det = a * d - b * c;
            const x = (e * d - b * f) / det;
            const y = (a * f - e * c) / det;
            runner.assertEquals(x, 2);
            runner.assertEquals(y, 1);
        });

        runner.test('x + 2y = 8, 3x - y = 7 ‚Üí x=3, y=2.5', () => {
            // 3 + 2*2.5 = 8 ‚úì, 3*3 - 2.5 = 6.5 ‚úó ‚Üí use x=22/7, y=17/7
            // Actually: x + 2y = 8, 3x - y = 7 ‚Üí x = 22/7 ‚âà 3.14, y = 17/7 ‚âà 2.43
            // Let's use simpler: 2x + y = 8, x - y = 1 ‚Üí x=3, y=2
            const a = 2, b = 1, e = 8;
            const c = 1, d = -1, f = 1;
            const det = a * d - b * c;
            const x = (e * d - b * f) / det;
            const y = (a * f - e * c) / det;
            runner.assertEquals(x, 3);
            runner.assertEquals(y, 2);
        });

        runner.test('Parallel lines: det = 0', () => {
            const a = 1, b = 2;
            const c = 2, d = 4;
            const det = a * d - b * c;
            runner.assertEquals(det, 0, 'No unique solution');
        });

        // ===================================
        // 3x3 SYSTEMS OF EQUATIONS
        // ===================================
        runner.section('üìä 3x3 Systems of Equations');
        
        const det3x3 = (a1, b1, c1, a2, b2, c2, a3, b3, c3) => {
            return a1 * (b2 * c3 - b3 * c2) - 
                   b1 * (a2 * c3 - a3 * c2) + 
                   c1 * (a2 * b3 - a3 * b2);
        };
        
        runner.test('Simple 3x3: x+y=6, 2x+y+z=11, x+2y+z=11', () => {
            const a1 = 1, b1 = 1, c1 = 0, d1 = 6;
            const a2 = 2, b2 = 1, c2 = 1, d2 = 11;
            const a3 = 1, b3 = 2, c3 = 1, d3 = 11;
            
            const det = det3x3(a1, b1, c1, a2, b2, c2, a3, b3, c3);
            const detX = det3x3(d1, b1, c1, d2, b2, c2, d3, b3, c3);
            const detY = det3x3(a1, d1, c1, a2, d2, c2, a3, d3, c3);
            const detZ = det3x3(a1, b1, d1, a2, b2, d2, a3, b3, d3);
            
            const x = detX / det;
            const y = detY / det;
            const z = detZ / det;
            
            // Verify by substitution
            runner.assertClose(a1 * x + b1 * y + c1 * z, d1, 0.01);
            runner.assertClose(a2 * x + b2 * y + c2 * z, d2, 0.01);
            runner.assertClose(a3 * x + b3 * y + c3 * z, d3, 0.01);
        });

        runner.test('3x3: 2x+y-z=1, x+3y+z=5, 3x-y+2z=3', () => {
            const a1 = 2, b1 = 1, c1 = -1, d1 = 1;
            const a2 = 1, b2 = 3, c2 = 1, d2 = 5;
            const a3 = 3, b3 = -1, c3 = 2, d3 = 3;
            
            const det = det3x3(a1, b1, c1, a2, b2, c2, a3, b3, c3);
            const detX = det3x3(d1, b1, c1, d2, b2, c2, d3, b3, c3);
            const detY = det3x3(a1, d1, c1, a2, d2, c2, a3, d3, c3);
            const detZ = det3x3(a1, b1, d1, a2, b2, d2, a3, b3, d3);
            
            const x = detX / det;
            const y = detY / det;
            const z = detZ / det;
            
            // Verify by substitution
            runner.assertClose(a1 * x + b1 * y + c1 * z, d1, 0.01);
            runner.assertClose(a2 * x + b2 * y + c2 * z, d2, 0.01);
            runner.assertClose(a3 * x + b3 * y + c3 * z, d3, 0.01);
        });

        runner.test('3x3 Identity: x=1, y=2, z=3', () => {
            const a1 = 1, b1 = 0, c1 = 0, d1 = 1;
            const a2 = 0, b2 = 1, c2 = 0, d2 = 2;
            const a3 = 0, b3 = 0, c3 = 1, d3 = 3;
            
            const det = det3x3(a1, b1, c1, a2, b2, c2, a3, b3, c3);
            const detX = det3x3(d1, b1, c1, d2, b2, c2, d3, b3, c3);
            const detY = det3x3(a1, d1, c1, a2, d2, c2, a3, d3, c3);
            const detZ = det3x3(a1, b1, d1, a2, b2, d2, a3, b3, d3);
            
            const x = detX / det;
            const y = detY / det;
            const z = detZ / det;
            
            runner.assertClose(x, 1, 0.01);
            runner.assertClose(y, 2, 0.01);
            runner.assertClose(z, 3, 0.01);
        });

        runner.test('3x3 Singular system: det = 0', () => {
            const a1 = 1, b1 = 1, c1 = 1;
            const a2 = 2, b2 = 2, c2 = 2;
            const a3 = 3, b3 = 3, c3 = 3;
            
            const det = det3x3(a1, b1, c1, a2, b2, c2, a3, b3, c3);
            runner.assertClose(det, 0, 0.0001, 'Dependent equations');
        });

        // ===================================
        // MATRIX OPERATIONS
        // ===================================
        runner.section('üî≤ Matrix Operations');
        
        runner.test('2x2 Addition', () => {
            const A = [[1, 2], [3, 4]];
            const B = [[5, 6], [7, 8]];
            const result = addMatrices(A, B);
            runner.assertEquals(result[0][0], 6);
            runner.assertEquals(result[1][1], 12);
        });

        runner.test('2x2 Multiplication', () => {
            const A = [[1, 2], [3, 4]];
            const B = [[5, 6], [7, 8]];
            const result = multiplyMatrices(A, B);
            runner.assertEquals(result[0][0], 19);
            runner.assertEquals(result[0][1], 22);
            runner.assertEquals(result[1][0], 43);
            runner.assertEquals(result[1][1], 50);
        });

        runner.test('2x2 Determinant: [[1,2],[3,4]] = -2', () => {
            const result = calculateDeterminant([[1, 2], [3, 4]]);
            runner.assertEquals(result, -2);
        });

        runner.test('2x2 Inverse exists', () => {
            const result = invertMatrix([[1, 2], [3, 4]]);
            runner.assertTrue(result !== null, 'Should have inverse');
        });

        runner.test('Singular matrix has no inverse', () => {
            const result = invertMatrix([[1, 2], [2, 4]]);
            runner.assertTrue(result === null, 'Should not have inverse');
        });

        runner.test('3x3 Determinant', () => {
            const A = [[1, 2, 3], [4, 5, 6], [7, 8, 9]];
            const result = calculateDeterminant(A);
            runner.assertEquals(result, 0, 'This matrix is singular');
        });

        runner.test('3x3 Non-singular determinant', () => {
            const A = [[1, 0, 0], [0, 1, 0], [0, 0, 1]];
            const result = calculateDeterminant(A);
            runner.assertEquals(result, 1, 'Identity matrix');
        });

        // ===================================
        // POLYNOMIAL LONG DIVISION
        // ===================================
        runner.section('üìê Polynomial Long Division');
        
        runner.test('Simple exact division: (x^2 - 1) √∑ (x - 1) = x + 1', () => {
            const dividend = [1, 0, -1]; // x^2 - 1
            const divisor = [1, -1];     // x - 1
            const result = dividePolynomials(dividend, divisor);
            
            runner.assertTrue(result !== null, 'Should return result');
            runner.assertEquals(result.quotient.length, 2);
            runner.assertClose(result.quotient[0], 1, 0.01, 'Quotient coef 1');
            runner.assertClose(result.quotient[1], 1, 0.01, 'Quotient coef 2');
            runner.assertEquals(result.remainder[0], 0, 'No remainder');
        });

        runner.test('Cubic division: (x^3 - 2x^2 + x - 2) √∑ (x - 2) = x^2 + 1', () => {
            const dividend = [1, -2, 1, -2]; // x^3 - 2x^2 + x - 2
            const divisor = [1, -2];          // x - 2
            const result = dividePolynomials(dividend, divisor);
            
            runner.assertTrue(result !== null);
            runner.assertEquals(result.quotient.length, 3);
            runner.assertClose(result.quotient[0], 1, 0.01);
            runner.assertClose(result.quotient[1], 0, 0.01);
            runner.assertClose(result.quotient[2], 1, 0.01);
        });

        runner.test('Division with remainder: (x^2 + 3x + 5) √∑ (x + 1)', () => {
            const dividend = [1, 3, 5]; // x^2 + 3x + 5
            const divisor = [1, 1];     // x + 1
            const result = dividePolynomials(dividend, divisor);
            
            runner.assertTrue(result !== null);
            runner.assertTrue(result.remainder[0] !== 0, 'Should have non-zero remainder');
        });

        runner.test('Parse polynomial: "2x^3 + 3x^2 - x + 5"', () => {
            const result = parsePolynomial('2x^3 + 3x^2 - x + 5');
            runner.assertEquals(result[0], 2, 'x^3 coefficient');
            runner.assertEquals(result[1], 3, 'x^2 coefficient');
            runner.assertEquals(result[2], -1, 'x coefficient');
            runner.assertEquals(result[3], 5, 'constant term');
        });

        runner.test('Parse with spaces: "x^2 + 2x + 1"', () => {
            const result = parsePolynomial('x^2 + 2x + 1');
            runner.assertEquals(result.length, 3);
            runner.assertEquals(result[0], 1);
            runner.assertEquals(result[1], 2);
            runner.assertEquals(result[2], 1);
        });

        runner.test('Format polynomial: [1, -2, 3] contains "x^2"', () => {
            const result = formatPolynomial([1, -2, 3]);
            runner.assertContains(result, 'x^2');
        });

        runner.test('Division by zero polynomial returns null', () => {
            const result = dividePolynomials([1, 2, 3], [0, 0]);
            runner.assertTrue(result === null, 'Should return null');
        });

        // ===================================
        // GCD/LCM FUNCTIONS
        // ===================================
        runner.section('üîó GCD & LCM');
        
        runner.test('gcd(12, 8) = 4', () => {
            runner.assertEquals(gcd(12, 8), 4);
        });

        runner.test('gcd(17, 13) = 1 (coprime)', () => {
            runner.assertEquals(gcd(17, 13), 1);
        });

        runner.test('gcd(100, 25) = 25', () => {
            runner.assertEquals(gcd(100, 25), 25);
        });

        runner.test('lcm(4, 6) = 12', () => {
            runner.assertEquals(lcm(4, 6), 12);
        });

        runner.test('lcm(3, 5) = 15', () => {
            runner.assertEquals(lcm(3, 5), 15);
        });

        runner.test('gcdMultiple([12, 18, 24]) = 6', () => {
            runner.assertEquals(gcdMultiple([12, 18, 24]), 6);
        });

        runner.test('lcmMultiple([4, 6, 8]) = 24', () => {
            runner.assertEquals(lcmMultiple([4, 6, 8]), 24);
        });

        runner.test('primeFactorization(60) = {2:2, 3:1, 5:1}', () => {
            const factors = primeFactorization(60);
            runner.assertEquals(factors[2], 2);
            runner.assertEquals(factors[3], 1);
            runner.assertEquals(factors[5], 1);
        });

        runner.test('primeFactorization(17) = {17:1} (prime)', () => {
            const factors = primeFactorization(17);
            runner.assertEquals(factors[17], 1);
        });

        // ===================================
        // MODULAR ARITHMETIC
        // ===================================
        runner.section('üîê Modular Arithmetic');
        
        runner.test('modulo(17, 5) = 2', () => {
            runner.assertEquals(modulo(17, 5), 2);
        });

        runner.test('modulo(-17, 5) = 3 (positive result)', () => {
            runner.assertEquals(modulo(-17, 5), 3);
        });

        runner.test('modularInverse(3, 7) = 5', () => {
            runner.assertEquals(modularInverse(3, 7), 5);
        });

        runner.test('modularInverse(2, 6) = null (no inverse)', () => {
            runner.assertTrue(modularInverse(2, 6) === null);
        });

        runner.test('modularPower(2, 10, 1000) = 24', () => {
            runner.assertEquals(modularPower(2, 10, 1000), 24);
        });

        runner.test('modularPower(3, 5, 13) = 9', () => {
            runner.assertEquals(modularPower(3, 5, 13), 9);
        });

        // ===================================
        // COMBINATORICS
        // ===================================
        runner.section('üé≤ Combinatorics');
        
        runner.test('factorial(5) = 120', () => {
            runner.assertEquals(factorial(5), 120);
        });

        runner.test('factorial(0) = 1', () => {
            runner.assertEquals(factorial(0), 1);
        });

        runner.test('factorial(10) = 3628800', () => {
            runner.assertEquals(factorial(10), 3628800);
        });

        runner.test('factorialBig(5) = 120n', () => {
            runner.assertEquals(Number(factorialBig(5)), 120);
        });

        runner.test('permutation(5, 3) = 60', () => {
            runner.assertEquals(Number(permutation(5, 3)), 60);
        });

        runner.test('permutation(10, 2) = 90', () => {
            runner.assertEquals(Number(permutation(10, 2)), 90);
        });

        runner.test('combination(5, 2) = 10', () => {
            runner.assertEquals(Number(combination(5, 2)), 10);
        });

        runner.test('combination(10, 3) = 120', () => {
            runner.assertEquals(Number(combination(10, 3)), 120);
        });

        runner.test('combination(n, 0) = 1', () => {
            runner.assertEquals(Number(combination(7, 0)), 1);
        });

        runner.test('combination(n, n) = 1', () => {
            runner.assertEquals(Number(combination(7, 7)), 1);
        });

        // ===================================
        // FRACTIONS
        // ===================================
        runner.section('üçï Fractions');
        
        runner.test('simplify 6/8 = 3/4', () => {
            const result = simplifyFractionFunc(6, 8);
            runner.assertEquals(result.num, 3);
            runner.assertEquals(result.den, 4);
        });

        runner.test('simplify 15/25 = 3/5', () => {
            const result = simplifyFractionFunc(15, 25);
            runner.assertEquals(result.num, 3);
            runner.assertEquals(result.den, 5);
        });

        runner.test('simplify 7/7 = 1/1', () => {
            const result = simplifyFractionFunc(7, 7);
            runner.assertEquals(result.num, 1);
            runner.assertEquals(result.den, 1);
        });

        runner.test('fractionToMixed 7/3 = 2 and 1/3', () => {
            const result = fractionToMixed(7, 3);
            runner.assertEquals(result.whole, 2);
            runner.assertEquals(result.num, 1);
            runner.assertEquals(result.den, 3);
        });

        runner.test('fractionToMixed 5/2 = 2 and 1/2', () => {
            const result = fractionToMixed(5, 2);
            runner.assertEquals(result.whole, 2);
            runner.assertEquals(result.num, 1);
            runner.assertEquals(result.den, 2);
        });

        // ===================================
        // STATISTICS
        // ===================================
        runner.section('üìä Statistics');
        
        runner.test('calculateMean([1,2,3,4,5]) = 3', () => {
            runner.assertEquals(calculateMean([1, 2, 3, 4, 5]), 3);
        });

        runner.test('calculateMedian([1,2,3,4,5]) = 3', () => {
            runner.assertEquals(calculateMedian([1, 2, 3, 4, 5]), 3);
        });

        runner.test('calculateMedian([1,2,3,4]) = 2.5', () => {
            runner.assertEquals(calculateMedian([1, 2, 3, 4]), 2.5);
        });

        runner.test('calculateMode([1,2,2,3,3,3]) = [3]', () => {
            const result = calculateMode([1, 2, 2, 3, 3, 3]);
            runner.assertEquals(result[0], 3);
        });

        runner.test('calculateVariance([2,4,4,4,5,5,7,9], population) = 4', () => {
            const result = calculateVariance([2, 4, 4, 4, 5, 5, 7, 9], false);
            runner.assertTrue(Math.abs(result - 4) < 0.01);
        });

        runner.test('calculateStdDev([2,4,4,4,5,5,7,9], population) = 2', () => {
            const result = calculateStdDev([2, 4, 4, 4, 5, 5, 7, 9], false);
            runner.assertEquals(result, 2);
        });

        // ===================================
        // SEQUENCES (using actual function names)
        // ===================================
        runner.section('üìà Sequences');
        
        runner.test('generateArithmeticSequence(2, 3, 5) returns 5 terms', () => {
            const result = generateArithmeticSequence(2, 3, 5);
            runner.assertEquals(result.terms.length, 5);
            runner.assertArrayEquals(result.terms, [2, 5, 8, 11, 14]);
        });

        runner.test('generateGeometricSequence(2, 3, 4) returns correct terms', () => {
            const result = generateGeometricSequence(2, 3, 4);
            runner.assertEquals(result.terms.length, 4);
            runner.assertArrayEquals(result.terms, [2, 6, 18, 54]);
        });

        runner.test('generateFibonacciSequence(8) returns Fibonacci', () => {
            const result = generateFibonacciSequence(8);
            runner.assertArrayEquals(result.terms, [0, 1, 1, 2, 3, 5, 8, 13]);
        });

        runner.test('Arithmetic sum formula: n/2 * (2a + (n-1)d)', () => {
            const result = generateArithmeticSequence(1, 2, 5);
            runner.assertEquals(result.sum, 25); // 1+3+5+7+9 = 25
        });

        runner.test('Geometric sum formula: a*(1-r^n)/(1-r)', () => {
            const result = generateGeometricSequence(1, 2, 5);
            runner.assertEquals(result.sum, 31); // 1+2+4+8+16 = 31
        });

        // ===================================
        // TAYLOR SERIES (with correct 3-param signature)
        // ===================================
        runner.section('üìê Taylor Series');
        
        runner.test('taylorSin(0, 0, 10) ‚âà 0', () => {
            const result = taylorSin(0, 0, 10);
            runner.assertTrue(Math.abs(result) < 0.0001);
        });

        runner.test('taylorCos(0, 0, 10) ‚âà 1', () => {
            const result = taylorCos(0, 0, 10);
            runner.assertTrue(Math.abs(result - 1) < 0.0001);
        });

        runner.test('taylorExp(1, 0, 15) ‚âà e', () => {
            const result = taylorExp(1, 0, 15);
            runner.assertTrue(Math.abs(result - Math.E) < 0.0001);
        });

        runner.test('taylorExp(0, 0, 10) = 1', () => {
            const result = taylorExp(0, 0, 10);
            runner.assertTrue(Math.abs(result - 1) < 0.0001);
        });

        runner.test('taylorSin(œÄ/2, 0, 15) ‚âà 1', () => {
            const result = taylorSin(Math.PI / 2, 0, 15);
            runner.assertTrue(Math.abs(result - 1) < 0.001);
        });

        runner.test('taylorCos(œÄ, 0, 15) ‚âà -1', () => {
            const result = taylorCos(Math.PI, 0, 15);
            runner.assertTrue(Math.abs(result + 1) < 0.001);
        });

        // ===================================
        // NUMERICAL INTEGRATION (with function, not string)
        // ===================================
        runner.section('‚à´ Numerical Integration');
        
        runner.test('trapezoidalRule x¬≤ from 0 to 1 ‚âà 0.333', () => {
            const f = x => x * x;
            const result = trapezoidalRule(f, 0, 1, 1000);
            runner.assertTrue(Math.abs(result - 1/3) < 0.01);
        });

        runner.test('simpsonsRule x¬≤ from 0 to 1 ‚âà 0.333', () => {
            const f = x => x * x;
            const result = simpsonsRule(f, 0, 1, 1000);
            runner.assertTrue(Math.abs(result - 1/3) < 0.001);
        });

        runner.test('trapezoidalRule sin(x) from 0 to œÄ ‚âà 2', () => {
            const f = x => Math.sin(x);
            const result = trapezoidalRule(f, 0, Math.PI, 1000);
            runner.assertTrue(Math.abs(result - 2) < 0.01);
        });

        runner.test('simpsonsRule constant from 0 to 5 = 25 (5*5)', () => {
            const f = x => 5;
            const result = simpsonsRule(f, 0, 5, 100);
            runner.assertTrue(Math.abs(result - 25) < 0.01);
        });

        runner.test('simpsonsRule x from 0 to 2 = 2 (area of triangle)', () => {
            const f = x => x;
            const result = simpsonsRule(f, 0, 2, 100);
            runner.assertTrue(Math.abs(result - 2) < 0.01);
        });

        // ===================================
        // BASE CONVERSION (using native JS)
        // ===================================
        runner.section('üîÑ Base Conversion');
        
        runner.test('Number.toString(2): 10 ‚Üí "1010"', () => {
            runner.assertEquals((10).toString(2), '1010');
        });

        runner.test('Number.toString(16): 255 ‚Üí "ff"', () => {
            runner.assertEquals((255).toString(16).toUpperCase(), 'FF');
        });

        runner.test('Number.toString(8): 64 ‚Üí "100"', () => {
            runner.assertEquals((64).toString(8), '100');
        });

        runner.test('parseInt("1010", 2) = 10', () => {
            runner.assertEquals(parseInt('1010', 2), 10);
        });

        runner.test('parseInt("FF", 16) = 255', () => {
            runner.assertEquals(parseInt('FF', 16), 255);
        });

        runner.test('parseInt("100", 8) = 64', () => {
            runner.assertEquals(parseInt('100', 8), 64);
        });

        // ===================================
        // UNIT CONVERSION (testing the unitConversions object)
        // ===================================
        runner.section('üìè Unit Conversion');
        
        runner.test('unitConversions.length exists', () => {
            runner.assertTrue(typeof unitConversions.length !== 'undefined');
        });

        runner.test('unitConversions.mass exists', () => {
            runner.assertTrue(typeof unitConversions.mass !== 'undefined');
        });

        runner.test('unitConversions.temperature exists', () => {
            runner.assertTrue(typeof unitConversions.temperature !== 'undefined');
        });

        runner.test('1m = 100cm', () => {
            const mToBase = 1 / unitConversions.length.meter;
            const baseToCm = mToBase * unitConversions.length.centimeter;
            runner.assertEquals(baseToCm, 100);
        });

        runner.test('1km = 1000m', () => {
            const kmToBase = 1 / unitConversions.length.kilometer;
            const baseToM = kmToBase * unitConversions.length.meter;
            runner.assertEquals(baseToM, 1000);
        });

        runner.test('1kg = 1000g', () => {
            const kgToBase = 1 / unitConversions.mass.kilogram;
            const baseToG = kgToBase * unitConversions.mass.gram;
            runner.assertEquals(baseToG, 1000);
        });

        // ===================================
        // LATEX PARSER
        // ===================================
        runner.section('üìù LaTeX Parser');
        
        runner.test('parseLatexEquation function exists', () => {
            runner.assertTrue(typeof parseLatexEquation === 'function');
        });

        runner.test('Parse basic equation', () => {
            const result = parseLatexEquation('x + 1 = 0');
            runner.assertTrue(result !== null, 'Should parse successfully');
        });

        // ===================================
        // EDGE CASES
        // ===================================
        runner.section('‚ö†Ô∏è Edge Cases');
        
        runner.test('Quartic with double roots', () => {
            const roots = findPolynomialRoots([1, -6, 13, -12, 4]);
            runner.assertTrue(roots.length >= 2);
        });

        runner.test('Complex power with i', () => {
            const i = { re: 0, im: 1 };
            const i2 = complexMul(i, i);
            runner.assertEquals(i2.re, -1, 'i¬≤ = -1');
            runner.assertEquals(i2.im, 0);
        });

        runner.test('Division by near-zero complex', () => {
            const a = { re: 1, im: 0 };
            const b = { re: 0.0001, im: 0.0001 };
            const result = complexDiv(a, b);
            runner.assertTrue(isFinite(result.re));
        });

        runner.test('Large factorial', () => {
            const result = factorialBig(20);
            runner.assertEquals(result.toString(), '2432902008176640000');
        });

        runner.test('Empty array statistics', () => {
            const result = calculateMean([]);
            runner.assertTrue(result === null || isNaN(result) || result === 0);
        });

        runner.test('Single element array mean', () => {
            const result = calculateMean([42]);
            runner.assertEquals(result, 42);
        });

        runner.test('gcd with zero', () => {
            runner.assertEquals(gcd(5, 0), 5);
            runner.assertEquals(gcd(0, 5), 5);
        });

        runner.test('factorial edge: factorial(1) = 1', () => {
            runner.assertEquals(factorial(1), 1);
        });

        // Run all tests
        runner.run();
    </script>
</body>
</html>
